ESP32Shell for the Arduino Framework by vvb333007 <vvb@nym.hush.com>

Генератор прямоугольных испульсов
---------------------------------

ESPShell позволяет включть аппаратную генерацию заданной частоты и скважности
на люблм пине. Частота может иметь диапазон от 1Гц до 78кГц, скважность (duty)
задается числом с плаващей точкой, в диапахоне от 0 до 1. Так, 0.6 это 60% duty

Параметр duty является необязательным, и, если не указан, устанавливается в
значение по умолчанию равное 0.5 (50%)


Для включения\выключения генерации на каком-либо GPIO используется
команда "tone". Пример включения генератора с частотой 1Гц на пине номер 2:

  esp32#>tone 2 1

Пример включения генератора с частотой 5 кГц и скважностью 10%:

  esp32#>tone 2 5000 0.1

Для выключения генератора следует не указывать ни частоту ни скважность:

  esp32#>tone 2



Для подсчета импульсов на каком либо пине используется аппаратный счетчик 
импульсов (PCNT, см. документацию к ESP-IDF). Сам счетчик - 16 битовый, поэтому
при измерении частот следует использовать коротенькие интервалы времени для
подсчета импульсов (см. примеры ниже)

Комманда запускающая счетчик, "count" имеет три параметра: первый, обязательный,
это номер пина, на котором мы собрались считать импульсы. Второй параметр, это 
время, в миллисекундах, в течении которого производится подсчет. Значение по
умолчанию - 1000 миллисекунд. Последний, третий параметр - указание шеллу, какие 
именно импульсы считать (положительный перепад, отрицательный или оба). По 
умолчанию считаем положительные импульсы. Если считать и те и другие, то значение 
счетчика будет равно удвоенному количеству импульсов. 

Для демонстрации работы счетчика соеденим GPIO2 и GPIO4 проводом. На пине 2 запустим
генератор прямоугольных сигналов, а на пине 4 будем их считать:
and count pulses on pin4:

  esp32#>tone 2 10
  esp32#>count 4
  % Counting pulses on GPIO4.. 10 pulses (1.000 sec)
  esp32#>


Тут надо обратить внимание на одну особенность счетчика, о которой было немного
сказано в начале: счетчик 16-ти битный. Это означает, что он переполнится после
того, как досчитает до 65535 и начнет считать с 0. Поэтому, при измерении высоких
частот рекомендуется уменьшить время замера.

Пример переполнения счетчика:

  esp32#>tone 2 70000
  esp32#>count 4
  % Counting pulses on GPIO4.. 4413 pulses (1.000 sec)
  esp32#>

За одну секунду счетчик получил 70000 импульсов и переполнился, нача считать с нуля.
Давайте попробуем уменьшить время замера в 10 раз, до 100мс:


esp32#>count 4 100
% Counting pulses on GPIO4.. 7011 pulses (0.100 sec)
esp32#>

Видим, что за 100 миллисекунд пришло 7011 импульсов, что похоже на правду (70000 в 
секунду)
