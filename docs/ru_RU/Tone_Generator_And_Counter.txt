ESP32Shell for the Arduino Framework by vvb333007 <vvb@nym.hush.com>

ГЕНЕРАТОР ПРЯМОУГОЛЬНЫХ ИСПУЛЬСОВ
---------------------------------

ESPShell позволяет включть аппаратную генерацию заданной частоты и скважности
на люблм пине. Частота может иметь диапазон от 1Гц до 312кГц, скважность (duty)
задается числом с плаващей точкой, в диапазоне от 0 до 1. Так, 0.6 это 60% duty

Параметр duty является необязательным, и, если не указан, устанавливается в
значение по умолчанию равное 0.5 (50%), минимальное значение скважности - 0.005
(0.5%)


Для включения\выключения генерации на каком-либо GPIO используется
команда "pwm". Пример включения генератора с частотой 1Гц на пине номер 2:

  esp32#>pwm 2 1

Пример включения генератора с частотой 5 кГц и скважностью 10%:

  esp32#>pwm 2 5000 0.1

Для выключения генератора следует не указывать ни частоту ни скважность:

  esp32#>pwm 2



СЧЕТЧИК ИМПУЛЬСОВ (ЧАСТОТОМЕР)
------------------------------

Для подсчета импульсов на каком либо пине используется аппаратный счетчик 
импульсов (PCNT, см. документацию к ESP-IDF).

Комманда запускающая счетчик, "count", имеет три параметра: первый, обязательный,
это номер пина, на котором мы собрались считать импульсы. Второй параметр, это 
время, в миллисекундах, в течении которого производится подсчет. Значение по
умолчанию - 1000 миллисекунд. Последний, третий параметр - указание шеллу, какие 
именно импульсы считать (положительный перепад, отрицательный или оба). По 
умолчанию считаем положительные импульсы. Если считать и те и другие, то значение 
счетчика будет равно удвоенному количеству импульсов. 

Для демонстрации работы счетчика соеденим GPIO2 и GPIO4 проводом. На пине 2 запустим
генератор прямоугольных сигналов, а на пине 4 будем их считать:

  esp32#>pwm 2 10
  esp32#>count 4
  % Counting pulses on GPIO4.. 10 pulses (1.000 sec)
  esp32#>

По умолчанию, команда "count" производит замер в течении секунды, и это ок, если нам
нужно измерять частоту. Но что если импульсы, которые мы считаем, это не переодичный сигнал?
Что если жто какие-то редкие импульсы, приходящие раз в минуту от, скажем, датчика 
открытия двери? Хотелось бы считать импульсы в течении неопределенно долгого периода времени,
при жтом не дожидаться лклнчания выполнения команды "count". Хотелось бы, чтобы команда 
"count" выполнялась в фоновом режиме, чтобы отпускала консоль и можно было бы вводить другие 
команды.

Такая возможность есть, для этого используется команда "count&". Она в точности соответствует 
команде "count" но исполняется в фоновом режиме и не прерывается нажатием клавишт <Enter>:
для того чтобы прервать такую команду, надо воспользоваться командой "kill":

  esp32#>count& 4 100000
  % Async "count" command task ID is 3ffb8fdc
  % Use "kill 3ffb8fdc" to stop command execution
  % Counting pulses on GPIO4 (any key to abort)..
  esp32#>
  esp32#>kill 3ffb8fdc
  34 pulses in 17.250 sec

В примере выше, команда "count" запускается в фоновом режиме, на подсчет импульсов на 4-ом пине,
в течении 100 секунд. Команда, вначале исполнения сообщает, как ее остановить: исполнить команду
"kill 3ffb8fdc", которую мы просто копируем мышкой. Команда была прервана после 17 секунд и к 
тому времени успела насчитать 34 импульса

Эксперементируйте!
