ESP32Shell for the Arduino Framework by vvb333007 <vvb@nym.hush.com>



KEYS USED IN ESPSHELL FOR COMMAND LINE EDITING:
-----------------------------------------------

<ENTER>        : Execute command

<- -> /\  \/   : Arrows: move cursor left or right. Up and down arrows scroll 
                 through command history.

<DEL>          : As in Notepad

<BACKSPACE>    : As in Notepad

<HOME>, <END>  : Do not work! Use Ctrl+A instead of <HOME> and Ctrl+E as <END>

<TAB>          : Quick jump from one word in the line to another. Fast switching
                 between command arguments. Continously press to cycle through
                 all arguments/words in line

Ctrl+R         : History search. Press Ctrl+R and start typing. Press <ENTER> 
                 to search for command executed before

Ctrl+K         : Clear the line from cursor to the end

Ctrl+L         : Clear the screen, keep user input

Ctrl+Z         : Same as entering "exit" and pressing <ENTER>

Ctrl+C         : Suspend sketch execution. Resume with "resume" command


Please note that above list can be obtained by shell command "? keys". Also
note that Ctrl+... sequences work on terminal software (TeraTerm, PuTTY, cu)
but do not work in ArduinoIDE Serial Monitor as it lacks the ability to send
Ctrl+... key sequences.

By entering "? keys" command one also can find the key combinations which
can be used on "dumb" terminals: if for example arrow keys in your terminal
are not working correctly you can use Ctrl+F or B as an alternative keys.

Pressing <ESC>, then entering 1..3 digit decimal number and pressing <ESC> again
is the way to enter arbitrary ascii symbol code: ESC, 3, ESC sends <Ctrl+C> for
example


AUTOCOMPLETION
--------------

ESPShell won't autocomplete commands for you on pressing <TAB>: instead ESPShell
simply accepts non-completed input. In linux shell one types "upt" and presses
<TAB> to let the shell autocomplete the command to "uptime". In contrast in ESPShell
one can simply type "upt" (or even "up") and press <Enter>. ESPShell does not require
anyone to type command "sequence": "seq" is more than enough.

Same about command arguments - any command or command argument can be shortened


CONTEXT HELP
------------

Normally one can read help pages for commands by entering a question mark "?" 
followed by keyword: either shortened or full. If, however, you would like to
see help page during command entering (e.g. you forgot what next argument should 
be) then just press "?" and help page will be displayed. You can try to type
"cou" and press "?" to see "count" command help page


ESPSHELL COMMANDS AND THEIR DESCRIPTION
---------------------------------------

List of commands can be obtained at any time by typing "?" and pressing <Enter>
Commands can be entered in shortened form: "seq" or even "se" instead of 
"sequence" or "rel" instead of "reload". ESPShell's parser does a partial match
of the command name to user input allowing for shortening command names


Same applies to command arguments:
  For example, instead of entering "pin 2 out open high" one can type something
  like "pi 2 ou h" to get the same result. If there is ambiguity happens then
  parser just chooses first match:


List of all supported command can be obtained by typing "?" and pressing <Enter>

Help on a specific command can be obtained by typing "?" a space, command name 
and pressing <Enter>: "? command_name"

Here is the list of currently supported commands (main command tree):

% Enter "? keys" to display the espshell keyboard help page
%
% "?"          : Commands list & help
% "uptime"     : System uptime
% "show"       : Display information
% "pin"        : Pins (GPIO) commands
% "cpu"        : Set/show CPU parameters
% "reload"     : Reset CPU
% "mem"        : Memory commands
% "nap"        : CPU sleep
% "iic"        : I2C commands
% "uart"       : UART commands
% "sequence"   : Sequence configuration
% "files"      : Filesystem access
% "echo"       : Enable/Disable user input echo
% "suspend"    : Suspend sketch execution
% "resume"     : Resume sketch execution
% "kill"       : Kill tasks
% "pwm"        : PWM output
% "count"      : Pulse counter
% "var"        : Sketch variables
% "exit"       : Exit


"exit"     - Executed in a command subdirectory exits from that subdirectory; 
             executed in main command tree does nothing unless  it has 1 
             parameter, an optional keyword "exit": if this the case then 
             espshell exits and removes its task. Resources associated with 
             espshell are not freed.

           - Hint: Ctrl+Z is a key which enters command "exit" and presses <Enter>
                   for you.


"uptime"   - Shows how much time has passed since last boot

"pin"      - Various pin commands.Command takes multiple arguments of which
             1st argument is always pin number. More information and examples
             on this command can be found in documentation file
             "docs/Pin_Commands.txt"

"cpu"      - 1. Shows CPUID, CPU frequency, xtal frequency and bus frequency. 
                Displays CPU core temperature, Arduino Core version along with
                ESP-IDF version used as well as ARDUINO_BOARD and ARDUINO_VARIANT:

                   esp32#>cpu

                   % CPU ID: ESP32-D0WD-V3, Rev.: 1.45
                   % CPU frequency is 240Mhz, Xtal 40Mhz, APB bus 80Mhz
                   % Chip temperature: 37.8 C
                   %
                   % Sketch is running on ESP32_DEV/esp32,uses Arduino Core v3.0.5, based on
                   % Espressif ESP-IDF version "v5.1.4-828-g33fbade6b8-dirty"
                   % Last boot was 1 minutes 35 seconds ago
                   % Restart reason was "reload command"
                   esp32#>


           - 2. Set CPU frequency to X MHz. List of supported frequencies is 
                displayed on attempt to set unsupported frequency:
            
                   esp32#>cpu 99
                   % Supported frequencies are: 240, 160, 120, 80, 40, 20 and 10

"show memory" - Display memory usage info: total/free memory both on heap and
                in PSRAM (SPIRAM) if available:

               esp32#>mem
               % -- Memory information --
               % malloc():
               % 308496 bytes total, 266924 available, 110580 max per allocation
               % heap_caps_malloc():
               % 369772 bytes total,  327348 available, 110580 max per allocation
               esp32#>

               NOTE: memory available to classic mallo is different from 
               heap_caps_malloc(MALLOC_CAPS_INTERNAL). Real size depend on what 
               memory allocation function you use. malloc() internally calls
               heap_caps_malloc(MALLOC_CAPS_DEFAULT). PSRAM allocation is only
               available to heap_caps_malloc() allocater but not for malloc()

"show memory ADDRESS [LENGTH]"
             - Display memory contents for given address. First argument is the address
               in hexadecimal form and second, optional argument is the length in bytes
               of memory segment to be displayed. Length is set to 256 bytes by default.
               

               esp32#>mem 3fff0000 21
                     0  1  2  3   4  5  6  7   8  9  A  B   C  D  E  F  |0123456789ABCDEF
              ----------------------------------------------------------+----------------
              0000: 00 00 00 00  db d3 07 f8  da 22 1e 0c  20 81 01 00  |....??.??".. â€ž..
              0010: 00 00 00 00  e9                                     |....?               

"show seq X" - Shows information about signal pattern X. See documentation file
             "docs/Pulse_Generator.txt" for more  information on sequences and
             their use

               

"reload"   - Reboots ESP32
	     Hint: command "cpu" and "uptime" shows the last reboot cause: was
                   it caused by watchdog timer interrupt, or system crash etc

"nap"      - Put CPU into light sleep. CPU wakes up by UART activity (press any
             key to wake up). Wake up condition is 3 positive edges on UART0 
             which is almost any key (spacebar requires 2 presses).
                                  OR
             Puts CPU into light sleep for X seconds, CPU wakes up by timer.
             Type "? nap" do get more information on this command

"iic"      - I2C bus/interface access. Configure and use (read/write/scan) a
             specified I2C bus (there are number of them available).
             Detailed descriptin of I2C commands is in "docs/I2C_Commands.txt"

           - IMPORTANT: you don't need to "exit" from a command subdirectory
             if you want to execute command from the main tree: just enter the
             command while in a subdirectory. ESPShell will search main command
             tree if subdirectory has no matching command

"uart"     - UART X interface access. Configure and use (read/write/bridge) UART
             interface. Read "docs/UART_Commands.txt" for details on how to
             setup and use UART interfaces

           - IMPORTANT: you don't need to "exit" from a command subdirectory
             if you want to execute command from the main tree: just enter the
             command while in a subdirectory. ESPShell will search main command
             tree if subdirectory has no matching command


"sequence" - Signal generator commands. Allow for custom signal patterns with 
             precise timings to be generated on any pin. See documentation file
             "docs/Pulse_Generator.txt" for more info. Simple patterns can also
             be generated by means of "pin" command (see "docs/Pin_Commands.txt")

           - IMPORTANT: you don't need to "exit" from a command subdirectory
             if you want to execute command from the main tree: just enter the
             command while in a subdirectory. ESPShell will search main command
             tree if subdirectory has no matching command


"files"    - Enter file manager mode. This mode allows user to perform basic file 
             system commands (list directory contens, file and directory creation,
             file editing and file transfer). Details are in "docs/Filesystem_Commands.txt"

             shell on uarts other than default leaving UART0 purely for sketch.


"echo off" - Disables ESPShell from printing out its prompt and disables user
             input echo. This mode is used for automated processing when UART
             output is going to be parsed by some software. Equivalent of common
             "ATE0" command for modems. When echo is disabled. user still can
             use line editing/history scrolling but it is just not displayed.

"echo on"  - Default is to echo user input & display espshell prompt

"echo silent" - Completely disable ALL espshell output to the terminal. No error
                messages will be displayed. Commands being executed will not
                display anything.

"suspend"  - Pause Arduino's loop(). Tasks that were started by the loop()
             task are not suspended by this command

           - Hint: Pressing Ctrl+C does the same thing if done in terminal

"resume"   - Resume execution of Arduino's loop() previously paused with
             "suspend" command

"kill TASK_ID" - stop execution of task TASK_ID. The TASK_ID is either task id displayed
                 upon executionf of background commands or generic FreeRTOS task id. If killing
                 an arbitrary FreeRTOS task one have to specify an extra keyword "terminate":

                esp32#>kill 0x3fff0000 terminate      <------ to kill an arbitrary task
                esp32#>kill 0x3fff0000                <------ safely stop & close tasks created by 
                                                              background commands (see "pin&", 
                                                              "count&" etc)

"pwm"      - Squarewave generator: generates signal of specified frequency and 
             duty on pin X. See Tone_Generator_And_Counter.txt for details, but
             in short, to start a PWM on pin 2, frequency 312kHz and duty cycle
             of 5% one can enter "pwm 2 312000 0.05" and press <Enter>

"count"    - Pulse counter: counts pulses arrived on pin. Details on the
             counter and squarewave generator can be found in documentation
             file "docs/Tone_Generator_And_Counter.txt", but in short it
             is "count 10" to count pulses for 1000ms on pin 10. Type 
             "count 10 100" to count pulses for 100ms or "count 10 100 neg"
             if you want to count negative edges (default behaviour is to count
             positive edges)

             By default this command blocks until its finished (1 second or more if specified).
             To run this command in a background one can use "&" modifier:

              esp32#>count& 4 999999
              % Background task started
              % Copy/paste "kill 0x3ffb8d38" command to stop execution
              % Counting pulses on GPIO4...

            Background counting can be interrupted by "kill" command as hinted in example above:

              esp32#>kill 0x3ffb8d38
              % 0 pulses in 9.250 seconds (0.0 Hz)
              % Background task 0x3ffb8d38 ("count&") is finished
              esp32#>

"var"        Display/Set user sketch variables or convert numbers to different bases. Variables 
             must be registered by calling convar_add(VariableName) from the main sketch. There 
             are variables registered by ESPShell internally. Those are used to change default 
             ESPShell behaviour, like display directory sizes or not, ignore question mark or 
             process it as a hot key and so on
             
             "var" with no arguments displays the list of registered sketch variables:

            esp32#>var
            %   Sketch variables (use "var NAME" to see variable values)
            % Variable X name | sizeof(X) |     typeof(X)    |
            %-----------------+-----------+------------------+----------------
            %     tbl_min_len |         2 | [un]signed short |
            %       bypass_qm |         4 |   [un]signed int |
            %       pcnt_unit |         4 |   [un]signed int |
            %    pcnt_channel |         4 |   [un]signed int |
            %ls_show_dir_size |         4 |   [un]signed int | 
            

            "var NAME" will display a variable value:

              esp32#>var bypass
              % // 0x0 in hex
              % unsigned int bypass_qm = 0; // unsigned or ...
              %   signed int bypass_qm = 0; // ... signed
              esp32#>

            "var NAME VALUE" is used to set variable new value:


              esp32#>var bypass 1   <------- set "bypass_qm" to "1"
              esp32#>var bypass
              % // 0x1 in hex
              % unsigned int bypass_qm = 1; // unsigned or ...
              %   signed int bypass_qm = 1; // ... signed
              esp32#>

            "var NUMBER" will display NUMBER in different bases:



              esp32#>var 0x777
              % "0x777" is a number, which can be written as
              % unsigned : 1911
              %   signed : 1911
              % FP number: 0.000000
              % hex      : 0x777
              % oct      : 03567
              % bin      : "0b11101110111


              

              esp32#>var 0b0001111
              % "0b0001111" is a number, which can be written as
              % unsigned : 15
              %   signed : 15
              % FP number: 0.000000
              % hex      : 0xf
              % oct      : 017
              % bin      : "0b1111
            

